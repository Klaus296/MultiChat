<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  document.addEventListener("DOMContentLoaded", () => {
  socket.emit("get user-name"); // запрос имени
  socket.emit("show friends");  // запрос списка друзей
  socket.emit("show rooms");
  socket.on("set name", (name) => {
    document.getElementById("user-name").textContent = name;
  });
  socket.on("username",(username)=>{
    const name = username;
  })
  socket.on("friends", (userFriends) => {
    const friendsContainer = document.querySelector("#friends-list");
    friendsContainer.innerHTML = "";
    socket.on("createRoomSuccess", (newRoom) => {
      console.log("New Room");
    });
    if (!userFriends || userFriends.length === 0) {
      friendsContainer.innerHTML = `<p class="text-gray-500">No friends found</p>`;
      return;
    }
    userFriends.forEach(friendName => {
      const friendCard = document.createElement("div");
      friendCard.className =
        "flex items-center gap-3 p-4 bg-gray-100 rounded-lg shadow-sm hover:bg-gray-200 transition";
      friendCard.innerHTML = `
        <div class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold">
          ${friendName[0].toUpperCase()}
        </div>
        <span class="font-medium">${friendName}</span>
      `;
      friendCard.onclick = () => toFriendChat(friendName);
      friendsContainer.appendChild(friendCard);
    });
  });

  // ⬇️ теперь форма точно существует
  document.getElementById("change-profile").addEventListener("submit", (e) => {
    e.preventDefault();
    const changeName = document.querySelector('input[name="name"]').value.trim();
    const changeBio = document.querySelector('textarea[name="bio"]').value.trim();
    console.log("Click");
    socket.emit("save profile", { name: changeName, bio: changeBio });
  });

  function toFriendChat(name) {
    console.log("Переход к чату с:", name);
    window.location.href = `/your?name=${encodeURIComponent(name)}`;
  }
});

socket.on("rooms", (rooms) => {
  const roomsContainer = document.querySelector("#rooms-list");
  roomsContainer.innerHTML = "";
  
  if (!rooms || rooms.length === 0) {
    roomsContainer.innerHTML = `<p class="text-gray-500">No rooms yet</p>`;
    return;
  }
  
  rooms.forEach(room => {
    const roomCard = document.createElement("div");
    roomCard.className =
      "p-4 bg-indigo-100 rounded-lg shadow hover:bg-indigo-200 transition";
    roomCard.innerHTML = `
      <h3 class="font-semibold">${room}</h3>
    `;
    roomsContainer.appendChild(roomCard);
    roomCard.onclick = () => toRoomChat(room);
  });
});
function toRoomChat(roomName){
  window.location.href='/main?room=${encodeURIComponent(room)}';
}

</script>

  <style>
    /* Скрываем все секции по умолчанию */
    .tab-content {
      display: none;
    }
    /* Показываем секцию, если она является целью (:target) */
    .tab-content:target {
      display: block;
    }
    /* Показываем профиль по умолчанию, если нет цели */
    #profile:not(:target) ~ .tab-content#profile {
      display: block;
    }
    /* Стили для активной кнопки */
    .tab-link:not([href="#profile"]):not(:hover) {
      background-color: #e5e7eb; /* bg-gray-200 */
    }
    .tab-link[href="#profile"] {
      background-color: #4f46e5; /* bg-indigo-500 */
      color: white;
    }
    .tab-link:target, .tab-link[href="#profile"]:not(:target) ~ .tab-link[href="#profile"] {
      background-color: #4f46e5; /* bg-indigo-500 */
      color: white;
    }
    .tab-link:not(:target):hover {
      background-color: #d1d5db; /* bg-gray-300 */
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen">
  <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-5xl">
    <!-- Profile Header -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 text-center sm:text-left">
      <h1 id="user-name" class="text-2xl sm:text-3xl font-bold">John Doe</h1>
      <p class="text-gray-600 mt-2">Passionate developer and coffee enthusiast.</p>
    </div>

    <!-- Tabs Navigation -->
    <div class="flex justify-center sm:justify-start gap-4 mb-6">
      <a href="#profile" class="tab-link px-4 py-2 rounded-lg font-medium text-gray-900">Profile</a>
      <a href="#settings" class="tab-link px-4 py-2 rounded-lg font-medium text-gray-900">Settings</a>
      <a href="#friends" class="tab-link px-4 py-2 rounded-lg font-medium text-gray-900">Friends</a>
      <a href="#rooms" class="tab-link px-4 py-2 rounded-lg font-medium text-gray-900">Rooms</a>
    </div>

    <!-- Profile Section -->
    <div id="profile" class="tab-content bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl sm:text-2xl font-semibold mb-4">Edit Profile</h2>
      <form id="change-profile">
        <input type="text" name="name" placeholder="Введите имя">
        <textarea name="bio" placeholder="О себе"></textarea>
        <button type="submit">Сохранить</button>
      </form>
    </div>

    <!-- Settings Section -->
    <div id="settings" class="tab-content bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl sm:text-2xl font-semibold mb-4">Settings</h2>
      <div class="space-y-4">
        <div>
          <h3 class="text-lg font-medium">Theme</h3>
          <p class="text-gray-600 mt-2">Theme switching is not available without JavaScript.</p>
        </div>
        <div>
          <h3 class="text-lg font-medium">Language</h3>
          <p></p>
        </div>
        <div>
          <h3 class="text-lg font-medium">Account</h3>
          <p></p>
        </div>
        <div>
          <h3 class="text-lg font-medium">Security</h3>
          <p></p>
        </div>
        <div>
          <h3 class="text-lg font-medium">Exit</h3>
          <p></p>
        </div>
      </div>
    </div>
    <!-- Friends Section -->
    <!-- Friends Section -->
    <!-- Friends Section -->
    <div id="friends" class="tab-content bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl sm:text-2xl font-semibold mb-4">Friends</h2>
      <div id="friends-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Друзья будут добавляться сюда -->
      </div>
    </div>
    <div id="rooms" class="tab-content bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl sm:text-2xl font-semibold mb-4">Rooms</h2>
      <div id="rooms-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Друзья будут добавляться сюда -->
      </div>
    </div>


    
  </div>
</body>
</html>