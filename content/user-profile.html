<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const userFriends = [];
  const mainRooms = [];
  document.addEventListener("DOMContentLoaded", () => {
   // запрос имени
  socket.emit("get user name")
  socket.emit("show friends");  // запрос списка друзей
  socket.emit("show rooms");
  socket.on("set name", (name) => {
    document.getElementById("user-name").textContent = name;
  });
  socket.on("username",(username)=>{
    const name = username;
    if (!name){
      window.location.href="/";
      return;
    }
  })

  socket.on("friends", (userFriends) => {
    const friendsContainer = document.querySelector("#friends-list");
    friendsContainer.innerHTML = "";
    socket.on("createRoomSuccess", (newRoom) => {
      console.log("New Room");
    });
    if (!userFriends || userFriends.length === 0) {
      friendsContainer.innerHTML = `<p class="text-gray-500">No friends found</p>`;
      return;
    }
    userFriends.forEach(friendName => {
      const friendCard = document.createElement("div");
      friendCard.className =
        "flex items-center gap-3 p-4 bg-gray-100 rounded-lg shadow-sm hover:bg-gray-200 transition";
      friendCard.innerHTML = `
        <div class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold">
          ${friendName[0].toUpperCase()}
        </div>
        <span class="font-medium">${friendName}</span>
      `;
      friendCard.onclick = () => toChat(friendName);
      friendsContainer.appendChild(friendCard);
    });
  });

  // ⬇️ теперь форма точно существует
  socket.on("user del",()=>{
    window.location.href="/";
  })
  function toChat(friend){
    socket.emit("get hash",friend);
    socket.on("set hash",(hash)=>{
      console.log(hash);    
      window.location.href = `/your?room=${encodeURIComponent(hash)}`;          
  })
    
  }
});

socket.on("rooms", (rooms) => {
  const roomsContainer = document.querySelector("#rooms-list");
  roomsContainer.innerHTML = "";
  
  if (!rooms || rooms.length === 0) {
    roomsContainer.innerHTML = `<p class="text-gray-500">No rooms yet</p>`;
    return;
  }
  
  rooms.forEach(room => {
    const roomCard = document.createElement("div");
    roomCard.className =
      "p-4 bg-indigo-100 rounded-lg shadow hover:bg-indigo-200 transition";
    roomCard.innerHTML = `
      <h3 class="font-semibold">${room}</h3>
      <button id="join-room" class="text-red-500 bg-gray-200 px-2 py-1 rounded hover:bg-gray-300" >Join</button>
      <button id="del-room" class="text-red-500 bg-gray-200 px-2 py-1 rounded hover:bg-gray-300" >Delete</button>
    `;
    
    roomsContainer.appendChild(roomCard);
    document.getElementById("join-room").onclick = ()=>{console.log("Join")};
    document.getElementById("del-room").onclick = ()=>{console.log(room);socket.emit("del room",(room))};
  });
});
socket.on("room delete error",(err)=>{
  alert(err);
})
function toRoomChat(roomName){
  window.location.href = `/room-chat?room=${encodeURIComponent(roomName)}`;
}


</script>

  <style>
    /* Скрываем все секции по умолчанию */
    .tab-content {
      display: none;
    }
    /* Показываем секцию, если она является целью (:target) */
    .tab-content:target {
      display: block;
    }
    /* Показываем профиль по умолчанию, если нет цели */
    #profile:not(:target) ~ .tab-content#profile {
      display: block;
    }
    /* Стили для активной кнопки */
    .tab-link:not([href="#profile"]):not(:hover) {
      background-color: #e5e7eb; /* bg-gray-200 */
    }
    .tab-link[href="#profile"] {
      background-color: #4f46e5; /* bg-indigo-500 */
      color: white;
    }
    .tab-link:target, .tab-link[href="#profile"]:not(:target) ~ .tab-link[href="#profile"] {
      background-color: #4f46e5; /* bg-indigo-500 */
      color: white;
    }
    .tab-link:not(:target):hover {
      background-color: #d1d5db; /* bg-gray-300 */
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen">
  <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-5xl">
    <!-- Profile Header -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 text-center sm:text-left">
      <a href="/chat" class="inline-block px-5 py-2 rounded-lg bg-indigo-500 text-white font-semibold shadow hover:bg-indigo-600 transition mb-4 sm:mb-0 text-center">
        Home
      </a>
      <h1 style="text-align: center;" id="user-name" class="text-2xl sm:text-3xl font-bold">User</h1>
    </div>

    <!-- Tabs Navigation -->
    <div class="flex justify-center sm:justify-start gap-4 mb-6">
      <a href="#settings" class="tab-link px-4 py-2 rounded-lg font-medium text-gray-900">Settings</a>
      <a href="#friends" class="tab-link px-4 py-2 rounded-lg font-medium text-gray-900">Friends</a>
      <a href="#rooms" class="tab-link px-4 py-2 rounded-lg font-medium text-gray-900">Rooms</a>
    </div>


    <!-- Settings Section -->
    <div id="settings" class="tab-content bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl sm:text-2xl font-semibold mb-4">Settings</h2>
      <div class="space-y-4">
        <div>
          <h3 class="text-lg font-medium">Theme</h3>
          <p class="text-gray-600 mt-2">Theme switching is not available without JavaScript.</p>
        </div>
        <div>
          <h3 class="text-lg font-medium">Language</h3>
          <p></p>
        </div>
        <div>
          <h3 class="text-lg font-medium">Account</h3>
          <p></p>
        </div>
        <div>
          <h3 class="text-lg font-medium">Security</h3>
          <p></p>
        </div>
        <div>
          <h3 onclick="socket.emit('del account')" class="text-lg font-medium">Exit</h3>
          <p></p>
        </div>
      </div>
    </div>
    <!-- Friends Section -->
    <!-- Friends Section -->
    <!-- Friends Section -->
    <div id="friends" class="tab-content bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl sm:text-2xl font-semibold mb-4">Friends</h2>
      <div id="friends-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Друзья будут добавляться сюда -->
      </div>
    </div>
    <div id="rooms" class="tab-content bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl sm:text-2xl font-semibold mb-4">Rooms</h2>
      <div id="rooms-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Друзья будут добавляться сюда -->
      </div>
    </div>


    
  </div>
</body>
</html>