<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Media Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2179616395540389"
     crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 font-['Inter'] min-h-screen flex flex-col">
  <!-- Top Search Bar -->
  <header class="fixed top-0 left-0 right-0 bg-gradient-to-r from-indigo-700 via-purple-700 to-pink-600 shadow-lg z-10">
    <div class="max-w-7xl mx-auto px-6 py-3 flex justify-between items-center">
      <!-- –õ–æ–≥–æ—Ç–∏–ø -->
      <h1 class="text-2xl font-bold text-white tracking-wide select-none">
        MultiChat
      </h1>

      <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
      <nav class="flex gap-6 items-center">
        <a 
          href="join_mafia" 
          class="relative px-5 py-2 rounded-lg text-lg font-semibold text-gold-200 hover:text-yellow-300 transition shadow-md overflow-hidden"
          style="color: gold;"
        >
          <!-- –§–æ–Ω —Å –º–∞—Ñ–∏–µ–π -->
          <span 
            class="absolute inset-0 bg-[url('/content/images/mafia.png')] bg-cover bg-center opacity-50 hover:opacity-70 transition"
          ></span>
          <span class="relative z-10">üé≠ Join Mafia</span>
        </a>

        <a 
          href="guess_the_number" 
          class="px-4 py-2 text-lg font-medium text-white hover:text-yellow-300 transition"
        >
          üî¢ Guess the number
        </a>
      </nav>
    </div>
  </header>


  <!-- Main Content -->
  <div class="flex flex-1 pt-16 w-full mx-auto px-4">
    
    <main style="width:80%;" class="flex-1 pr-4 overflow-y-auto" id="recomendations"></main>
    
    
    <!-- Right Sidebar -->
    <aside class="w-64 hidden lg:block">
      <div class="fixed top-16 h-[calc(100vh-4rem)] flex flex-col space-y-4 p-4">
        <button class="flex items-center space-x-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <a href="/search">Search</a>
        </button>
        <button class="flex items-center space-x-2 bg-gray-100 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-200 transition">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          <a href="/create">Create room</a>
        </button>
        <button class="flex items-center space-x-2 bg-gray-100 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-200 transition">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m6 13a2 2 0 01-2-2V7" />
          </svg>
          <a href="/messages">Messages</a>
        </button>
        <button class="flex items-center space-x-2 bg-gray-100 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-200 transition">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          <a href="/us_profile">Profile</a>
        </button>
      </div>
    </aside>
  </div>

  <!-- Mobile Bottom Navigation -->
  <nav class="lg:hidden fixed bottom-0 left-0 right-0 bg-white shadow-md">
    <div class="flex justify-around py-2">
      <button onclick="window.location.href = '/search'" class="flex flex-col items-center text-gray-600 hover:text-indigo-600 transition">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <a href="/search" class="text-xs">Search</a>
      </button>
      <button onclick="window.location.href = '/create'" class="flex flex-col items-center text-gray-600 hover:text-indigo-600 transition">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        <a href="/create" class="text-xs">Create room</a>
      </button>

      <button onclick="window.location.href = '/messages'" class="flex flex-col items-center text-gray-600 hover:text-indigo-600 transition">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m6 13a2 2 0 01-2-2V7" />
        </svg>
        <a href="/messages" class="text-xs">Messages</a>
      </button>
      <button onclick="window.location.href = '/us_profile'" class="flex flex-col items-center text-gray-600 hover:text-indigo-600 transition">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        <a href="/us_profile" class="text-xs">Profile</a>
      </button>
    </div>
  </nav>
<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io({ auth: { token: localStorage.getItem("token") } });
  const recomendations = document.getElementById("recomendations");
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(";").shift();
  }
  document.addEventListener("DOMContentLoaded", () => {
    
    socket.emit("getRooms");
  });
  
  socket.on("roomsList", (rooms) => {
  const container = document.getElementById("recomendations");
  container.innerHTML = "";
  const backgrounds = ["study.jpg", "social.jpg","mafia.png","nature.png"]; 
  rooms.forEach(room => {
    if (!room || !room.room_name) return;

    // üé® —Å–ª—É—á–∞–π–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–Ω–∞—Ç—ã
    const randomIndex = Math.floor(Math.random() * backgrounds.length);
    const background = backgrounds[randomIndex];

    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∫–æ–º–Ω–∞—Ç—ã
    const div = document.createElement("div");
    div.className = "w-full p-6 bg-white rounded-lg shadow mb-6 w-full max-w-3xl";
    div.style.width = "95%"; 
    div.style.height = "auto";
    div.style.fontSize = "1.1em";
    div.style.minWidth = "320px"; 
    div.style.backgroundImage = "url('/content/images/" + background + "')";
    div.style.backgroundSize = "cover";
    div.style.backgroundPosition = "center";

    div.innerHTML = `
      <h2 style="width:80%;background-color:#2596be; opacity:0.9;" class="text-lg font-semibold text-gray-800">${room.room_name}</h2>
      <p style="background-color:#2596be; opacity:0.9; color:gold;" class="text-gray-600">Description: ${room.description || ""}</p>
      <p style="background-color:#2596be; opacity:0.9;" class="text-gray-600">Language: ${room.language || ""}</p>
      <p align="right" style="background-color:#2596be; opacity:0.9; color:#FF2900; font-size:1.2em;">Author: ${room.user_name}</p>
      <button class="join-room mt-2 px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
        Join Room
      </button>
      <button class="save-room bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">Save</button>
    `;

    // Join Room button handler
    div.querySelector(".join-room").onclick = () => {
      document.cookie = `chat=${room.room_name}; path=/; max-age=` + 60*60*24*7;
      window.location.href = `/main?room=${encodeURIComponent(room.room_name)}`;
    };

    // Save Room button handler
    div.querySelector(".save-room").onclick = () => {
      console.log(room.user_name, room.room_name, room.description, room.language, room.categorie);
      const username = getCookie("username");
      socket.emit("add to main room", { 
        user: room.user_name, 
        username: username,
        room_name: room.room_name, 
        description: room.description, 
        language: room.language 
      });
    };

    container.appendChild(div);
  });
});

socket.on("main room error",(data)=>{
  alert(data);
})
socket.emit("createRoomSuccess", newRoom);
socket.broadcast.emit("newRoom", newRoom);

socket.on("main room added", (room_name) => {
  alert(`Room "${room_name}" added to your saved rooms!`);
});
  
</script>

</body>
</html>